
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Tutorial 4.3: FEM for a jacket wind turbine (Example only) &#8212; ComModHOS</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Tutorial 4.4: 2D Flow through porous media (Example only)" href="w4_t4.html" />
    <link rel="prev" title="Tutorial 4.2: FEM for an Euler-Bernoulli beam" href="w4_t2.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/TU_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">ComModHOS</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Computational Modelling of Hydraulic and Offshore Structures
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Course content
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Module1/module1_intro.html">
   Week 1
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Module1/module1-1_TaylorSeries.html">
     1.1. Taylor series
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Module1/module1-2_ApproxODEs.html">
     1.2. Approximating ODEs with Taylor series
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Module2/module2_intro.html">
   Week 2
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Module2/w2_t1.html">
     Tutorial 2.1: Linearizing the Equations of Motion (Example only)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Module2/w2_t2.html">
     Tutorial 2.2: Deriving the EOM of a pendulum
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Module2/w2_t3.html">
     Solution 2.3: Wave simulation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Module3/module3_intro.html">
   Week 3
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Module3/w3_t1.html">
     Tutorial 3.1: Solving the dynamic motion of a rod using Finite Differences
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Module3/w3_t2.html">
     Tutorial 3.2: Solving a cantilever beam with Finite Differences
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="module4_intro.html">
   Week 4
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="w4_t1.html">
     Tutorial 4.1: FEM for a rod (Example only)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="w3w4_t1_compare.html">
     Tutorial 4.1 b: FD or FEM for a rod
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="w4_t2.html">
     Tutorial 4.2: FEM for an Euler-Bernoulli beam
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Tutorial 4.3: FEM for a jacket wind turbine (Example only)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="w4_t4.html">
     Tutorial 4.4: 2D Flow through porous media (Example only)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Module5/module5_intro.html">
   Week 5
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Module5/w5_t1.html">
     Solution 5.1: Modal superposition of a jacket wind turbine
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Module5/w4w5_t1_compare.html">
     Solution 5.1b: Full FEM or Modal superposition for a jacket wind turbine
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../Module6/module6_intro.html">
   Week 6
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../Module6/w6_t1.html">
     Tutorial 6.1: Static string
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../Module6/w6_t2.html">
     Tutorial 6.2: Dynamic string (Example only)
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/TUDelft-CITG/ComModHOS.git/master?urlpath=tree/book/content/Module4/w4_t3.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/content/Module4/w4_t3.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#step-1-discretize-the-domain">
   Step 1: discretize the domain
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#step-2-define-the-shape-functions">
   Step 2: define the shape functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#step-3-computation-of-the-elemental-matrices">
   Step 3: computation of the elemental matrices
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#step-4-global-assembly">
   Step 4: global assembly
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#step-5-modal-analysis">
   Step 5: modal analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#step-5-solving-the-ode">
   Step 5: solving the ODE
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Tutorial 4.3: FEM for a jacket wind turbine (Example only)</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#step-1-discretize-the-domain">
   Step 1: discretize the domain
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#step-2-define-the-shape-functions">
   Step 2: define the shape functions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#step-3-computation-of-the-elemental-matrices">
   Step 3: computation of the elemental matrices
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#step-4-global-assembly">
   Step 4: global assembly
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#step-5-modal-analysis">
   Step 5: modal analysis
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#step-5-solving-the-ode">
   Step 5: solving the ODE
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="tutorial-4-3-fem-for-a-jacket-wind-turbine-example-only">
<h1>Tutorial 4.3: FEM for a jacket wind turbine (Example only)<a class="headerlink" href="#tutorial-4-3-fem-for-a-jacket-wind-turbine-example-only" title="Permalink to this headline">#</a></h1>
<p>In this tutorial we will use the FEM to solve a simplified jacket wind turbine. We assume that the structure can be modelled as a space frame with structural elements that are subject to axial discplacement and bending. Therefore, the equations of motion at a given element are given by:</p>
<div class="math notranslate nohighlight">
\[ \rho A \frac{\partial^2 u (x,t)}{\partial t^2} - E A \frac{\partial^2 u(x,t)}{\partial x^2} = q_u(x) \]</div>
<div class="math notranslate nohighlight">
\[ \rho A \frac{\partial^2 v (x,t)}{\partial t^2} + E I \frac{\partial^4 v(x,t)}{\partial x^4} = q_v(x) \]</div>
<p>The structure is schematically shown here:</p>
<center><img src="../../images/Module4/w4_t3_jacketshow.png" width="200" /></center>
<p>Let’s start by initializing the script and setting some parameters:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.integrate</span> <span class="k">as</span> <span class="nn">scp</span>

<span class="c1"># Input parameters</span>
<span class="c1"># Nacelle</span>
<span class="n">Mass_Nacelle</span> <span class="o">=</span> <span class="mi">5000</span>             <span class="c1"># [kg]</span>

<span class="c1"># Pile</span>
<span class="n">m_Pile</span> <span class="o">=</span> <span class="mi">1000</span>                   <span class="c1"># [kg/m]</span>
<span class="n">EI_Pile</span> <span class="o">=</span> <span class="mf">1e9</span>                   <span class="c1"># [N.m2]</span>
<span class="n">EA_Pile</span> <span class="o">=</span> <span class="mf">1e8</span>                   <span class="c1"># [N]</span>
<span class="n">H_Pile</span> <span class="o">=</span> <span class="mi">100</span>                    <span class="c1"># [m]</span>

<span class="c1"># Jacket</span>
<span class="n">m_Jacket</span> <span class="o">=</span> <span class="mi">100</span>                  <span class="c1"># [kg/m]</span>
<span class="n">EI_Jacket</span> <span class="o">=</span> <span class="mf">1e7</span>                 <span class="c1"># [N.m2]</span>
<span class="n">EA_Jacket</span> <span class="o">=</span> <span class="mf">1e6</span>                 <span class="c1"># [N]</span>
<span class="n">H_Jacket</span> <span class="o">=</span> <span class="mi">70</span>                   <span class="c1"># [m]</span>
<span class="n">Base_Jacket</span> <span class="o">=</span> <span class="mf">30.23</span>             <span class="c1"># [m]</span>
<span class="n">Top_Jacket</span> <span class="o">=</span> <span class="mf">16.13</span>              <span class="c1"># [m]</span>

<span class="c1"># Define load parameters</span>
<span class="n">f0</span> <span class="o">=</span> <span class="mi">2</span>                          <span class="c1"># [Hz]</span>
<span class="n">A0</span> <span class="o">=</span> <span class="mf">0.1</span>                        <span class="c1"># [m]</span>
<span class="n">T0</span> <span class="o">=</span> <span class="mi">20</span>                         <span class="c1"># [s]</span>

<span class="c1"># Define output time vector</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.01</span>                       <span class="c1"># [s]</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="o">*</span><span class="n">T0</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
<span class="n">nT</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="step-1-discretize-the-domain">
<h2>Step 1: discretize the domain<a class="headerlink" href="#step-1-discretize-the-domain" title="Permalink to this headline">#</a></h2>
<p>As usual, we start by discretizing the domain. We will discretize the structure using 21 nodes.</p>
<p>Here we first define a matrix with the nodal coordinates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define node coordinates</span>
<span class="n">NodeCoord</span> <span class="o">=</span> <span class="p">([</span><span class="o">-</span><span class="p">(</span><span class="n">Base_Jacket</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="n">Top_Jacket</span><span class="o">*</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>      <span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">H_Jacket</span><span class="o">/</span><span class="mi">4</span><span class="p">],</span>  <span class="c1"># Point 1</span>
              <span class="p">[(</span><span class="n">Base_Jacket</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="n">Top_Jacket</span><span class="o">*</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>      <span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">H_Jacket</span><span class="o">/</span><span class="mi">4</span><span class="p">],</span>  <span class="c1"># Point 2</span>
             <span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">Base_Jacket</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="n">Top_Jacket</span><span class="o">*</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>      <span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">H_Jacket</span><span class="o">/</span><span class="mi">4</span><span class="p">],</span>  <span class="c1"># Point 3</span>
              <span class="p">[(</span><span class="n">Base_Jacket</span><span class="o">*</span><span class="mi">3</span><span class="o">+</span><span class="n">Top_Jacket</span><span class="o">*</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>      <span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">H_Jacket</span><span class="o">/</span><span class="mi">4</span><span class="p">],</span>  <span class="c1"># Point 4</span>
             <span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">Base_Jacket</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="n">Top_Jacket</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>      <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">H_Jacket</span><span class="o">/</span><span class="mi">4</span><span class="p">],</span>  <span class="c1"># Point 5</span>
              <span class="p">[(</span><span class="n">Base_Jacket</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="n">Top_Jacket</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>      <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">H_Jacket</span><span class="o">/</span><span class="mi">4</span><span class="p">],</span>  <span class="c1"># Point 6</span>
             <span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">Base_Jacket</span><span class="o">*</span><span class="mi">1</span><span class="o">+</span><span class="n">Top_Jacket</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>      <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">H_Jacket</span><span class="o">/</span><span class="mi">4</span><span class="p">],</span>  <span class="c1"># Point 7</span>
              <span class="p">[(</span><span class="n">Base_Jacket</span><span class="o">*</span><span class="mi">1</span><span class="o">+</span><span class="n">Top_Jacket</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>      <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">H_Jacket</span><span class="o">/</span><span class="mi">4</span><span class="p">],</span>  <span class="c1"># Point 8</span>
             <span class="p">[</span><span class="o">-</span><span class="p">(</span><span class="n">Base_Jacket</span><span class="o">*</span><span class="mi">0</span><span class="o">+</span><span class="n">Top_Jacket</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>       <span class="mi">0</span><span class="o">*</span><span class="n">H_Jacket</span><span class="o">/</span><span class="mi">4</span><span class="p">],</span>  <span class="c1"># Point 9</span>
                                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="o">*</span><span class="n">H_Jacket</span><span class="o">/</span><span class="mi">4</span><span class="p">],</span>  <span class="c1"># Point 10</span>
              <span class="p">[(</span><span class="n">Base_Jacket</span><span class="o">*</span><span class="mi">0</span><span class="o">+</span><span class="n">Top_Jacket</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>       <span class="mi">0</span><span class="o">*</span><span class="n">H_Jacket</span><span class="o">/</span><span class="mi">4</span><span class="p">],</span>  <span class="c1"># Point 11</span>
                                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span>                 <span class="mi">10</span><span class="p">],</span>  <span class="c1"># Point 12</span>
                                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span>                 <span class="mi">20</span><span class="p">],</span>  <span class="c1"># Point 13</span>
                                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span>                 <span class="mi">30</span><span class="p">],</span>  <span class="c1"># Point 14</span>
                                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span>                 <span class="mi">40</span><span class="p">],</span>  <span class="c1"># Point 15</span>
                                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span>                 <span class="mi">50</span><span class="p">],</span>  <span class="c1"># Point 16</span>
                                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span>                 <span class="mi">60</span><span class="p">],</span>  <span class="c1"># Point 17</span>
                                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span>                 <span class="mi">70</span><span class="p">],</span>  <span class="c1"># Point 18</span>
                                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span>                 <span class="mi">80</span><span class="p">],</span>  <span class="c1"># Point 19</span>
                                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span>                 <span class="mi">90</span><span class="p">],</span>  <span class="c1"># Point 20</span>
                                             <span class="p">[</span><span class="mi">0</span><span class="p">,</span>                <span class="mi">100</span><span class="p">])</span>  <span class="c1"># Point 21</span>
<span class="n">nNode</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">NodeCoord</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Once we have the node coordinates we proceed to define the elemental connectivities. Here, we will use the same array to assign the material  properties to each element. Note that they are different depending on which part of the structure they belong to.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define elements (and their properties</span>
<span class="c1">#             NodeLeft    NodeRight          m         EA        EI</span>
<span class="n">Elements</span> <span class="o">=</span> <span class="p">(</span>         <span class="p">[</span><span class="mi">1</span><span class="p">,</span>            <span class="mi">3</span><span class="p">,</span>   <span class="n">m_Jacket</span><span class="p">,</span>  <span class="n">EA_Jacket</span><span class="p">,</span> <span class="n">EI_Jacket</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">1</span><span class="p">,</span>            <span class="mi">4</span><span class="p">,</span>   <span class="n">m_Jacket</span><span class="p">,</span>  <span class="n">EA_Jacket</span><span class="p">,</span> <span class="n">EI_Jacket</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">2</span><span class="p">,</span>            <span class="mi">4</span><span class="p">,</span>   <span class="n">m_Jacket</span><span class="p">,</span>  <span class="n">EA_Jacket</span><span class="p">,</span> <span class="n">EI_Jacket</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">3</span><span class="p">,</span>            <span class="mi">4</span><span class="p">,</span>   <span class="n">m_Jacket</span><span class="p">,</span>  <span class="n">EA_Jacket</span><span class="p">,</span> <span class="n">EI_Jacket</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">3</span><span class="p">,</span>            <span class="mi">5</span><span class="p">,</span>   <span class="n">m_Jacket</span><span class="p">,</span>  <span class="n">EA_Jacket</span><span class="p">,</span> <span class="n">EI_Jacket</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">5</span><span class="p">,</span>            <span class="mi">4</span><span class="p">,</span>   <span class="n">m_Jacket</span><span class="p">,</span>  <span class="n">EA_Jacket</span><span class="p">,</span> <span class="n">EI_Jacket</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">4</span><span class="p">,</span>            <span class="mi">6</span><span class="p">,</span>   <span class="n">m_Jacket</span><span class="p">,</span>  <span class="n">EA_Jacket</span><span class="p">,</span> <span class="n">EI_Jacket</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">5</span><span class="p">,</span>            <span class="mi">6</span><span class="p">,</span>   <span class="n">m_Jacket</span><span class="p">,</span>  <span class="n">EA_Jacket</span><span class="p">,</span> <span class="n">EI_Jacket</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">5</span><span class="p">,</span>            <span class="mi">7</span><span class="p">,</span>   <span class="n">m_Jacket</span><span class="p">,</span>  <span class="n">EA_Jacket</span><span class="p">,</span> <span class="n">EI_Jacket</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">5</span><span class="p">,</span>            <span class="mi">8</span><span class="p">,</span>   <span class="n">m_Jacket</span><span class="p">,</span>  <span class="n">EA_Jacket</span><span class="p">,</span> <span class="n">EI_Jacket</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">6</span><span class="p">,</span>            <span class="mi">8</span><span class="p">,</span>   <span class="n">m_Jacket</span><span class="p">,</span>  <span class="n">EA_Jacket</span><span class="p">,</span> <span class="n">EI_Jacket</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">7</span><span class="p">,</span>            <span class="mi">8</span><span class="p">,</span>   <span class="n">m_Jacket</span><span class="p">,</span>  <span class="n">EA_Jacket</span><span class="p">,</span> <span class="n">EI_Jacket</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">7</span><span class="p">,</span>            <span class="mi">9</span><span class="p">,</span>   <span class="n">m_Jacket</span><span class="p">,</span>  <span class="n">EA_Jacket</span><span class="p">,</span> <span class="n">EI_Jacket</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">9</span><span class="p">,</span>            <span class="mi">8</span><span class="p">,</span>   <span class="n">m_Jacket</span><span class="p">,</span>  <span class="n">EA_Jacket</span><span class="p">,</span> <span class="n">EI_Jacket</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">8</span><span class="p">,</span>           <span class="mi">11</span><span class="p">,</span>   <span class="n">m_Jacket</span><span class="p">,</span>  <span class="n">EA_Jacket</span><span class="p">,</span> <span class="n">EI_Jacket</span><span class="p">],</span>
                     <span class="p">[</span><span class="mi">9</span><span class="p">,</span>           <span class="mi">10</span><span class="p">,</span>   <span class="n">m_Jacket</span><span class="p">,</span>  <span class="n">EA_Jacket</span><span class="p">,</span> <span class="n">EI_Jacket</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">10</span><span class="p">,</span>           <span class="mi">11</span><span class="p">,</span>   <span class="n">m_Jacket</span><span class="p">,</span>  <span class="n">EA_Jacket</span><span class="p">,</span> <span class="n">EI_Jacket</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">10</span><span class="p">,</span>           <span class="mi">12</span><span class="p">,</span>   <span class="n">m_Pile</span><span class="p">,</span>    <span class="n">EA_Pile</span><span class="p">,</span>   <span class="n">EI_Pile</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">12</span><span class="p">,</span>           <span class="mi">13</span><span class="p">,</span>   <span class="n">m_Pile</span><span class="p">,</span>    <span class="n">EA_Pile</span><span class="p">,</span>   <span class="n">EI_Pile</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">13</span><span class="p">,</span>           <span class="mi">14</span><span class="p">,</span>   <span class="n">m_Pile</span><span class="p">,</span>    <span class="n">EA_Pile</span><span class="p">,</span>   <span class="n">EI_Pile</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">14</span><span class="p">,</span>           <span class="mi">15</span><span class="p">,</span>   <span class="n">m_Pile</span><span class="p">,</span>    <span class="n">EA_Pile</span><span class="p">,</span>   <span class="n">EI_Pile</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">15</span><span class="p">,</span>           <span class="mi">16</span><span class="p">,</span>   <span class="n">m_Pile</span><span class="p">,</span>    <span class="n">EA_Pile</span><span class="p">,</span>   <span class="n">EI_Pile</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">16</span><span class="p">,</span>           <span class="mi">17</span><span class="p">,</span>   <span class="n">m_Pile</span><span class="p">,</span>    <span class="n">EA_Pile</span><span class="p">,</span>   <span class="n">EI_Pile</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">17</span><span class="p">,</span>           <span class="mi">18</span><span class="p">,</span>   <span class="n">m_Pile</span><span class="p">,</span>    <span class="n">EA_Pile</span><span class="p">,</span>   <span class="n">EI_Pile</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">18</span><span class="p">,</span>           <span class="mi">19</span><span class="p">,</span>   <span class="n">m_Pile</span><span class="p">,</span>    <span class="n">EA_Pile</span><span class="p">,</span>   <span class="n">EI_Pile</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">19</span><span class="p">,</span>           <span class="mi">20</span><span class="p">,</span>   <span class="n">m_Pile</span><span class="p">,</span>    <span class="n">EA_Pile</span><span class="p">,</span>   <span class="n">EI_Pile</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">20</span><span class="p">,</span>           <span class="mi">21</span><span class="p">,</span>   <span class="n">m_Pile</span><span class="p">,</span>    <span class="n">EA_Pile</span><span class="p">,</span>   <span class="n">EI_Pile</span><span class="p">])</span>
<span class="n">nElem</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Elements</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s plot the structure to make sure that it looks like the model in the figure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="k">for</span> <span class="n">iElem</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nElem</span><span class="p">):</span>
    <span class="n">NodeLeft</span> <span class="o">=</span> <span class="n">Elements</span><span class="p">[</span><span class="n">iElem</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">NodeRight</span> <span class="o">=</span> <span class="n">Elements</span><span class="p">[</span><span class="n">iElem</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">Elements</span><span class="p">[</span><span class="n">iElem</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">EA</span> <span class="o">=</span> <span class="n">Elements</span><span class="p">[</span><span class="n">iElem</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">EI</span> <span class="o">=</span> <span class="n">Elements</span><span class="p">[</span><span class="n">iElem</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="n">m_Jacket</span> <span class="ow">and</span> <span class="n">EA</span> <span class="o">==</span> <span class="n">EA_Jacket</span> <span class="ow">and</span> <span class="n">EI</span> <span class="o">==</span> <span class="n">EI_Jacket</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
    <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="n">m_Pile</span> <span class="ow">and</span> <span class="n">EA</span> <span class="o">==</span> <span class="n">EA_Pile</span> <span class="ow">and</span> <span class="n">EI</span> <span class="o">==</span> <span class="n">EI_Pile</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: unknown material. Check your inputs.&quot;</span><span class="p">)</span>
        <span class="k">break</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">NodeCoord</span><span class="p">[</span><span class="n">NodeLeft</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">NodeCoord</span><span class="p">[</span><span class="n">NodeRight</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">NodeCoord</span><span class="p">[</span><span class="n">NodeLeft</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">NodeCoord</span><span class="p">[</span><span class="n">NodeRight</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/w4_t3_7_0.png" src="../../_images/w4_t3_7_0.png" />
</div>
</div>
</section>
<section id="step-2-define-the-shape-functions">
<h2>Step 2: define the shape functions<a class="headerlink" href="#step-2-define-the-shape-functions" title="Permalink to this headline">#</a></h2>
<p>Here we will use the exact same functions as in tutorial 4 and 5. Linear shape functions for the axial displacement and cubic shape functions for the deflection and rotations. Since we already know its expression and we already have the value of the elemental matrices, we skip this step in this tutorial.</p>
</section>
<section id="step-3-computation-of-the-elemental-matrices">
<h2>Step 3: computation of the elemental matrices<a class="headerlink" href="#step-3-computation-of-the-elemental-matrices" title="Permalink to this headline">#</a></h2>
<p>In the theory we have seen that the mass and stiffness elemental matrices for the space frame using linear and cubic shape functions are given by:</p>
<div class="math notranslate nohighlight">
\[\begin{split} \boldsymbol{M} = \frac{mL}{420} \begin{bmatrix} 140 &amp; 0 &amp; 0 &amp; 70 &amp; 0 &amp; 0 \\ 0 &amp; 156 &amp; 22L &amp; 0 &amp; 54 &amp; -13L \\ 0 &amp; 22L &amp; 4L^2 &amp; 0 &amp; 13L &amp; -3L^2 \\ 70 &amp; 0 &amp; 0 &amp; 140 &amp; 0 &amp; 0 \\ 0 &amp; 54 &amp; 13L &amp; 0 &amp; 156 &amp; -22L \\ 0 &amp; -13L &amp; -3L^2 &amp; 0 &amp; -22L &amp; 4L^2 \end{bmatrix} \end{split}\]</div>
<div class="math notranslate nohighlight">
\[\begin{split} \quad \boldsymbol{K} = \begin{bmatrix} \frac{EA}{L} &amp; 0 &amp; 0 &amp; \frac{-EA}{L} &amp;  0 &amp; 0 \\ 0 &amp; \frac{12EI}{L^3} &amp; \frac{6EI}{L^2} &amp; 0 &amp; \frac{-12EI}{L^3} &amp; \frac{6EI}{L^2} \\ 0 &amp; \frac{6EI}{L^2} &amp; \frac{4EI}{L} &amp; 0 &amp; \frac{-6EI}{L^2} &amp; \frac{2EI}{L} \\ \frac{-EA}{L} &amp; 0 &amp; 0 &amp; \frac{EA}{L} &amp; 0 &amp; 0 \\ 0 &amp; \frac{-12EI}{L^3} &amp; \frac{-6EI}{L^2} &amp; 0 &amp; \frac{12EI}{L^3} &amp; \frac{-6EI}{L^2} \\ 0 &amp; \frac{6EI}{L^2} &amp; \frac{2EI}{L} &amp; 0 &amp; \frac{-6EI}{L^2} &amp; \frac{4EI}{L} \end{bmatrix}\end{split}\]</div>
<p>These matrices are used directly when calling the <code class="docutils literal notranslate"><span class="pre">BeamMatrices</span></code> function within the assembly process.</p>
</section>
<section id="step-4-global-assembly">
<h2>Step 4: global assembly<a class="headerlink" href="#step-4-global-assembly" title="Permalink to this headline">#</a></h2>
<p>The last step is to compute the global matrices and the global forcing vector. We start by initializing the global matrices as 1-dimensional arrays.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nDof</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">nNode</span>              <span class="c1"># 3 Degrees of freedom per node</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nDof</span><span class="o">*</span><span class="n">nDof</span><span class="p">))</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nDof</span><span class="o">*</span><span class="n">nDof</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Then we loop over elements and perform all the elemental operations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">BeamMatrices</span> <span class="kn">import</span> <span class="n">BeamMatricesJacket</span>
<span class="k">for</span> <span class="n">iElem</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nElem</span><span class="p">):</span>
    <span class="c1"># Get the nodes of the elements</span>
    <span class="n">NodeLeft</span> <span class="o">=</span> <span class="n">Elements</span><span class="p">[</span><span class="n">iElem</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">NodeRight</span> <span class="o">=</span> <span class="n">Elements</span><span class="p">[</span><span class="n">iElem</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
    
    <span class="c1"># Get the degrees of freedom that correspond to each node</span>
    <span class="n">Dofs_Left</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">NodeLeft</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">Dofs_Right</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">NodeRight</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c1"># Get the properties of the element</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">Elements</span><span class="p">[</span><span class="n">iElem</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">EA</span> <span class="o">=</span> <span class="n">Elements</span><span class="p">[</span><span class="n">iElem</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">EI</span> <span class="o">=</span> <span class="n">Elements</span><span class="p">[</span><span class="n">iElem</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>

    <span class="c1"># Calculate the matrices of the element</span>
    <span class="n">Me</span><span class="p">,</span> <span class="n">Ke</span> <span class="o">=</span> <span class="n">BeamMatricesJacket</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">EA</span><span class="p">,</span> <span class="n">EI</span><span class="p">,</span> <span class="p">([</span><span class="n">NodeCoord</span><span class="p">[</span><span class="n">NodeLeft</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">NodeCoord</span><span class="p">[</span><span class="n">NodeLeft</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">NodeCoord</span><span class="p">[</span><span class="n">NodeRight</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">NodeCoord</span><span class="p">[</span><span class="n">NodeRight</span><span class="p">][</span><span class="mi">1</span><span class="p">]]))</span>

    <span class="c1"># Assemble the matrices at the correct place</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Dofs_Left</span><span class="p">,</span> <span class="n">Dofs_Right</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
            <span class="n">ij</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">nDof</span>
            <span class="c1">#print(ij)</span>
            <span class="n">M</span><span class="p">[</span><span class="n">ij</span><span class="p">]</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">ij</span><span class="p">]</span> <span class="o">+</span> <span class="n">Me</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="n">K</span><span class="p">[</span><span class="n">ij</span><span class="p">]</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="n">ij</span><span class="p">]</span> <span class="o">+</span> <span class="n">Ke</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            
<span class="c1"># Reshape the global matrix from a 1-dimensional array to a 2-dimensional array</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">M</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nDof</span><span class="p">,</span> <span class="n">nDof</span><span class="p">))</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">K</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">nDof</span><span class="p">,</span> <span class="n">nDof</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Now we have the global mass and stiffness matrices. However, in this example we have an additional point mass at the top corresponding to the nacelle. Then, we need to account for this mass adding its value at the corresponding DOFs, in this case the corresponding horizontal and vertical displacements associated to the top node.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nacelle_node</span> <span class="o">=</span> <span class="n">nNode</span>
<span class="n">nacelle_dof_h</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">nacelle_node</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">nacelle_dof_v</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="p">(</span><span class="n">nacelle_node</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
<span class="n">M</span><span class="p">[</span><span class="n">nacelle_dof_h</span><span class="p">,</span> <span class="n">nacelle_dof_h</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Mass_Nacelle</span>
<span class="n">M</span><span class="p">[</span><span class="n">nacelle_dof_v</span><span class="p">,</span> <span class="n">nacelle_dof_v</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Mass_Nacelle</span>
</pre></div>
</div>
</div>
</div>
<p>That completes the filling of the matrices. Let’s have a look at the matrices’ structure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at the matrix structure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">spy</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Mass matrix&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">spy</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Stiffness matrix&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/w4_t3_17_0.png" src="../../_images/w4_t3_17_0.png" />
<img alt="../../_images/w4_t3_17_1.png" src="../../_images/w4_t3_17_1.png" />
</div>
</div>
<p>To apply the boundary conditions, we will remove the rows associated to the fixed DOFs and add the contribution to the right-hand-side. First, we obtain the free and fixed DOFs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DofsP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>          <span class="c1"># prescribed DOFs</span>
<span class="n">DofsF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nDof</span><span class="p">)</span>       <span class="c1"># free DOFs</span>
<span class="n">DofsF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">DofsF</span><span class="p">,</span> <span class="n">DofsP</span><span class="p">)</span>  <span class="c1"># remove the fixed DOFs from the free DOFs array</span>

<span class="c1"># free &amp; fixed array indices</span>
<span class="n">fx</span> <span class="o">=</span> <span class="n">DofsF</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
<span class="n">fy</span> <span class="o">=</span> <span class="n">DofsF</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">bx</span> <span class="o">=</span> <span class="n">DofsP</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
<span class="n">by</span> <span class="o">=</span> <span class="n">DofsP</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
<p>We can re-order the matrices and vectors in blocks, such that it’s easy to operate with the blocks corresponding with the fixed DOFs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Mass</span>
<span class="n">M_FF</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">fx</span><span class="p">,</span> <span class="n">fy</span><span class="p">]</span>
<span class="n">M_FP</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">fx</span><span class="p">,</span> <span class="n">by</span><span class="p">]</span>
<span class="n">M_PF</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">bx</span><span class="p">,</span> <span class="n">fy</span><span class="p">]</span>
<span class="n">M_PP</span> <span class="o">=</span> <span class="n">M</span><span class="p">[</span><span class="n">bx</span><span class="p">,</span> <span class="n">by</span><span class="p">]</span>

<span class="c1"># Stiffness</span>
<span class="n">K_FF</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="n">fx</span><span class="p">,</span> <span class="n">fy</span><span class="p">]</span>
<span class="n">K_FP</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="n">fx</span><span class="p">,</span> <span class="n">by</span><span class="p">]</span>
<span class="n">K_PF</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="n">bx</span><span class="p">,</span> <span class="n">fy</span><span class="p">]</span>
<span class="n">K_PP</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="n">bx</span><span class="p">,</span> <span class="n">by</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-5-modal-analysis">
<h2>Step 5: modal analysis<a class="headerlink" href="#step-5-modal-analysis" title="Permalink to this headline">#</a></h2>
<p>Using the matrices associated to the free DOFs, we can perform a modal analysis to get more information on how the structure will deform and determine the natural frequencies.</p>
<div class="math notranslate nohighlight">
\[ ( \boldsymbol{K}_{FF} - \omega^2 \boldsymbol{M}_{FF} ) \boldsymbol{\phi} = \boldsymbol{0} \]</div>
<p>To compute the natural frequencies and mode shapes we use the <code class="docutils literal notranslate"><span class="pre">eig</span></code> command, which is part of the NumPy package. For more information see: <a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.linalg.eig.html">https://numpy.org/doc/stable/reference/generated/numpy.linalg.eig.html</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">M_FF</span><span class="p">),</span> <span class="n">K_FF</span><span class="p">)</span>
<span class="n">w2</span><span class="p">,</span> <span class="n">vr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eig</span><span class="p">(</span><span class="n">mat</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">w2</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">w</span><span class="o">/</span><span class="mi">2</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
</pre></div>
</div>
</div>
</div>
<p>We sort the frequencies and mode shapes in descending order:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">idx</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">argsort</span><span class="p">()[::</span><span class="mi">1</span><span class="p">]</span>  
<span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
<span class="n">ModalShape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">nDof</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)))</span>
<span class="n">ModalShape</span><span class="p">[</span><span class="mi">6</span><span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">vr</span><span class="p">[:,</span> <span class="n">idx</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s see what these modes look like. Here, we plot the first 9 modes. Note that the system will have 19 x 3 = 57 modes (as many as the discrete system DOFs).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nMode</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">nCol</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">nMode</span><span class="p">)))</span>
<span class="n">nRow</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nMode</span><span class="o">/</span><span class="n">nCol</span><span class="p">))</span>
<span class="k">for</span> <span class="n">iMode</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nMode</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">nRow</span><span class="p">,</span> <span class="n">nCol</span><span class="p">,</span> <span class="n">iMode</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Shape</span> <span class="o">=</span> <span class="n">ModalShape</span><span class="p">[:,</span> <span class="o">-</span><span class="n">iMode</span><span class="p">]</span>

    <span class="c1"># Scale the mode such that maximum deformation is 10</span>
    <span class="n">MaxTranslationx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Shape</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">3</span><span class="p">]))</span>
    <span class="n">MaxTranslationy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Shape</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">3</span><span class="p">]))</span>
    <span class="n">Shape</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="n">MaxTranslationx</span><span class="o">*</span><span class="mi">10</span>
    <span class="n">Shape</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">Shape</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="n">MaxTranslationy</span><span class="o">*</span><span class="mi">10</span>

    <span class="c1"># Get the deformed shape</span>
    <span class="n">DisplacedNode</span> <span class="o">=</span> <span class="p">([</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">NodeCoord</span><span class="p">]</span> <span class="o">+</span> <span class="n">Shape</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">NodeCoord</span><span class="p">]</span> <span class="o">+</span> <span class="n">Shape</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">iElem</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nElem</span><span class="p">):</span>
        <span class="n">NodeLeft</span> <span class="o">=</span> <span class="n">Elements</span><span class="p">[</span><span class="n">iElem</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">NodeRight</span> <span class="o">=</span> <span class="n">Elements</span><span class="p">[</span><span class="n">iElem</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">Elements</span><span class="p">[</span><span class="n">iElem</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">EA</span> <span class="o">=</span> <span class="n">Elements</span><span class="p">[</span><span class="n">iElem</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">EI</span> <span class="o">=</span> <span class="n">Elements</span><span class="p">[</span><span class="n">iElem</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="n">m_Jacket</span> <span class="ow">and</span> <span class="n">EA</span> <span class="o">==</span> <span class="n">EA_Jacket</span> <span class="ow">and</span> <span class="n">EI</span> <span class="o">==</span> <span class="n">EI_Jacket</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;b&#39;</span>
        <span class="k">elif</span> <span class="n">m</span> <span class="o">==</span> <span class="n">m_Pile</span> <span class="ow">and</span> <span class="n">EA</span> <span class="o">==</span> <span class="n">EA_Pile</span> <span class="ow">and</span> <span class="n">EI</span> <span class="o">==</span> <span class="n">EI_Pile</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR: unknown material. Check your inputs.&quot;</span><span class="p">)</span>
            <span class="k">break</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">DisplacedNode</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">NodeLeft</span><span class="p">],</span> <span class="n">DisplacedNode</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">NodeRight</span><span class="p">]],</span> 
                    <span class="p">[</span><span class="n">DisplacedNode</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">NodeLeft</span><span class="p">],</span> <span class="n">DisplacedNode</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">NodeRight</span><span class="p">]],</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Mode &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iMode</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;: f = &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="o">-</span><span class="n">iMode</span><span class="p">],</span><span class="mi">3</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot; Hz&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

<span class="c1"># automatically fix subplot spacing</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/w4_t3_27_0.png" src="../../_images/w4_t3_27_0.png" />
</div>
</div>
</section>
<section id="step-5-solving-the-ode">
<h2>Step 5: solving the ODE<a class="headerlink" href="#step-5-solving-the-ode" title="Permalink to this headline">#</a></h2>
<p>We can also solve the final ODE. In this example we assume that we don’t have an external force and the system is excited by the effect of an earthquak, modelled with the following horizontal motion at the boundary nodes:</p>
<div class="math notranslate nohighlight">
\[ u_P = A_0 sin (2\pi f_0t) \]</div>
<div class="math notranslate nohighlight">
\[ u'_P = 2 \pi f_0 A_0 cos(2\pi f_0t) \]</div>
<div class="math notranslate nohighlight">
\[ u''_P = - (2 \pi f_0)^2 A_0 sin(2\pi f_0t) \]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set Dimensions and initial conditions of state vector</span>
<span class="n">nDofsF</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">DofsF</span><span class="p">)</span>
<span class="n">udofs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">nDofsF</span><span class="p">)</span>
<span class="n">vdofs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nDofsF</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">nDofsF</span><span class="p">)</span>
<span class="n">q0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">nDofsF</span><span class="p">))</span>

<span class="c1"># Define the boundary conditions</span>
<span class="k">def</span> <span class="nf">ub</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">T0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;=</span> <span class="n">T0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">A0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">f0</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">dub_dt2</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">T0</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">f0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">ub</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">T0</span><span class="p">)</span>

<span class="c1"># Time span (output purposes)</span>
<span class="n">tf</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1">#50</span>
<span class="n">tspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tf</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>

<span class="c1"># Solve</span>
<span class="k">def</span> <span class="nf">odefun</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="n">vdofs</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">M_FF</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">K_FP</span><span class="p">,</span> <span class="n">ub</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">T0</span><span class="p">))</span> <span class="o">-</span> 
            <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">M_FP</span><span class="p">,</span> <span class="n">dub_dt2</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">T0</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">K_FF</span><span class="p">,</span> <span class="n">q</span><span class="p">[</span><span class="n">udofs</span><span class="p">])))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="n">sol</span> <span class="o">=</span> <span class="n">scp</span><span class="o">.</span><span class="n">solve_ivp</span><span class="p">(</span><span class="n">fun</span><span class="o">=</span><span class="n">odefun</span><span class="p">,</span> <span class="n">t_span</span><span class="o">=</span><span class="p">[</span><span class="n">tspan</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tspan</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">y0</span><span class="o">=</span><span class="n">q0</span><span class="p">,</span> <span class="n">t_eval</span><span class="o">=</span><span class="n">tspan</span><span class="p">)</span>  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot results</span>
<span class="n">u_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">tspan</span><span class="p">),</span> <span class="n">nDof</span><span class="p">))</span>
<span class="n">u_total</span><span class="p">[:,</span> <span class="n">DofsF</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">DofsF</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">udofs</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="n">udofs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:])</span>
<span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tspan</span><span class="p">)):</span>
    <span class="n">u_total</span><span class="p">[</span><span class="n">it</span><span class="p">,</span> <span class="n">DofsP</span><span class="p">]</span> <span class="o">=</span> <span class="n">ub</span><span class="p">(</span><span class="n">tspan</span><span class="p">[</span><span class="n">it</span><span class="p">],</span> <span class="n">T0</span><span class="p">)</span>
<span class="n">nacelle_result</span> <span class="o">=</span> <span class="n">u_total</span><span class="p">[:,</span> <span class="mi">60</span><span class="p">:</span><span class="mi">63</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">nacelle_result</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;u$_h$&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;u$_h$ [m]&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">nacelle_result</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;u$_v$&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;u$_v$ [m]&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">nacelle_result</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;$\phi_</span><span class="si">{top}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time[s]&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$\phi_</span><span class="si">{top}</span><span class="s2">$ [rad]&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/w4_t3_30_0.png" src="../../_images/w4_t3_30_0.png" />
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content\Module4"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="w4_t2.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Tutorial 4.2: FEM for an Euler-Bernoulli beam</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="w4_t4.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Tutorial 4.4: 2D Flow through porous media (Example only)</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By TU Delft Offshore Engineering<br/>
  
      &copy; Copyright 2023.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>